<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Exposing Spring Actuator endpoints via Jersey</title>
  <meta name="description" content="  Transparency makes the difference between a system that improves over time in production and one that stagnates on decays.[1]Spring Boot comes with a numbe...">

  <link rel="stylesheet" href="/blog/css/vendor/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css">
  <link rel="stylesheet" href="/blog/css/main_v2.css">
  <link rel="canonical" href="https://ruhkopf.name/blog/exposing-spring-actuator-endpoints-via-jersey-jax-rs">
  <link rel="alternate" type="application/rss+xml" title="Patrick Ruhkopf - Blog" href="https://ruhkopf.name/blog/feed.xml">

  <script src="/blog/js/vendor/picturefill.min.js"></script>

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/blog/">Patrick Ruhkopf - Blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          
          <a class="page-link" href="/blog/contact/">Contact</a>
          
                    
        
          
          
                    
        
          
          
                    
        
          
          
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
                    
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Exposing Spring Actuator endpoints via Jersey</h1>
    <p class="post-meta"><time datetime="2015-05-21T20:17:44-04:00" itemprop="datePublished">May 21, 2015</time>
    • <a href="tags/actuator">actuator</a>
    
    • <a href="tags/health">health</a>
    
    • <a href="tags/jax-rs">jax-rs</a>
    
    • <a href="tags/jersey">jersey</a>
    
    • <a href="tags/metrics">metrics</a>
    
    • <a href="tags/monitoring">monitoring</a>
    
    • <a href="tags/rest">rest</a>
    
    • <a href="tags/spring">spring</a>
    
    • <a href="tags/spring boot">spring boot</a>
    
    • <a href="tags/thread dump">thread dump</a>
    
    • <a href="tags/web service">web service</a>
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <blockquote>
  <p>Transparency makes the difference between a system that improves over time in production and one that stagnates on decays.<sup>[1]</sup></p>
</blockquote>

<p>Spring Boot comes with a number of <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">production ready endpoints</a> that expose information about your application’s configuration and health. This insight is vital for monitoring. By default Spring Actuator functionality is accessible via Spring MVC. This is not ideal when you use Jersey (JAX-RS) as your primary web service framework. In fact, if you use Spring Boot’s Jersey Starter sample project, the endpoints don’t even work out of the box (see <a href="https://github.com/spring-projects/spring-boot/issues/2025">Issue #2025</a>). In this post, I’m going to demonstrate how to expose the Actuator endpoints via Jersey.
<!--more-->
There are workarounds that are only based on configuration and do not require any code changes. For example as described in the issue’s comments, it’s possible to map Spring MVC’s <code class="highlighter-rouge">DispatcherServlet</code> under a different context, for example under /spring. This would allow you to access the Actuator services via this context. As an alternative it’s also possible to map Jersey’s <code class="highlighter-rouge">jerseyServlet</code> under a different name.<sup>[2]</sup> This, however, would mean that you need to access your resources under a different context. Both options aren’t really great, because they require you to use Spring MVC in addition to Jersey.</p>

<p>Fortunately, Spring’s architects decoupled the Actuator endpoints from the MVC controllers. This makes it possible to easily use and expose them via a Jersey endpoint. Here’s an example how to access the <em>health</em> and <em>metrics</em> Actuator endpoints under the root context. The data is exposed as JSON. As a bonus we print out the thread dump as text.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="code"><pre><span class="nd">@Path</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">({</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span> <span class="o">})</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActuatorEndpoints</span>
<span class="o">{</span>
  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">HealthEndpoint</span> <span class="n">health</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">MetricsEndpoint</span> <span class="n">metrics</span><span class="o">;</span>
  
  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="nc">DumpEndpoint</span> <span class="n">dump</span><span class="o">;</span>

  
  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/health"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getHealth</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="n">health</span><span class="o">.</span><span class="na">invoke</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/metrics"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getMetrics</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">metrics</span><span class="o">.</span><span class="na">invoke</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/metrics/{name:.*}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getMetric</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">)</span>
  <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">metrics</span><span class="o">.</span><span class="na">invoke</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
    <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotFoundException</span><span class="o">(</span><span class="s">"No such metric: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="nd">@GET</span>
  <span class="nd">@Path</span><span class="o">(</span><span class="s">"/dump"</span><span class="o">)</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">getThreadDump</span><span class="o">()</span>
  <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">StreamingOutput</span><span class="o">()</span>
    <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kd">final</span> <span class="nc">OutputStream</span> <span class="n">os</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">WebApplicationException</span>
      <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Writer</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="n">os</span><span class="o">));</span>
        <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">ThreadInfo</span> <span class="n">thread</span> <span class="o">:</span> <span class="n">dump</span><span class="o">.</span><span class="na">invoke</span><span class="o">())</span>
        <span class="o">{</span>
          <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">thread</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="n">writer</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>You can even disable the Spring MVC endpoints by setting a property. If you use the Actuator endpoints as shown above, they will still work.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre># disable spring mvc endpoints
endpoints.enabled=false
</pre></td></tr></tbody></table></code></pre></figure>

<p>Here’s an example output of the health Actuator mapped under <em>http://localhost:8080/health</em>.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"diskSpace"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"free"</span><span class="p">:</span><span class="w"> </span><span class="mi">58559954944</span><span class="p">,</span><span class="w">
    </span><span class="nl">"threshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">10485760</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>To conclude it’s easy to make use of the Spring Actuator endpoints without having to access them via Spring MVC.</p>

<hr />
<p><code class="highlighter-rouge">[1]</code> Michael T. Nygard, Release It!: Design and Deploy Production-Ready Software (Pragmatic Bookshelf; 1 edition, 2007), 271.</p>

<p><code class="highlighter-rouge">[2]</code> Rob’s Blog, 2015: <a href="https://rterp.wordpress.com/2015/02/09/using-spring-boot-actuator-endpoints-and-jersey-web-services/">Using Spring Boot Actuator Endpoints and Jersey Web Services</a></p>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Patrick Ruhkopf - Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Patrick Ruhkopf - Blog</li>
          <li>subscribe <a href="/blog/feed.xml">via RSS</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/restfulhead"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">restfulhead</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/restfulhead"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">restfulhead</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>My thoughts on programming, application design and (someday) photography. 
</p>
      </div>
    </div>

  </div>

</footer>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45866113-2"></script>

<script>
  window['ga-disable-UA-45866113-2'] = true;
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());
</script>

<script src="/blog/js/vendor/cookieconsent.min.c975ea3858dd8c7347d46343fb510ed236efbde6c0069cc6283eba7639d47e22a560c1391c6314247a0269e1380f93d31b662c4897fa770ab2514bd0bd2d2f68.js" data-cfasync="false"></script>
<script src="/blog/js/vendor/main.min.29e9a6941852b54310054e8af97cdded108192255658c2026001bb5ac7723e3ec11674a57a00352cf21dec4c3805a7755ee6009e8d8ca7d0578cfa3fe882f188.js"></script>





  </body>

</html>
